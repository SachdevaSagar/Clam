name: Xcode Unit Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-ios:
    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v2

    - name: Switch Xcode version
      run: sudo xcode-select -s "/Applications/Xcode_13.4.1.app"

    - name: Xcode version
      run: /usr/bin/xcodebuild -version

    - name: Prepare iOS 12 simulator
      run: |
            sudo mkdir -p /Library/Developer/CoreSimulator/Profiles/Runtimes
            sudo ln -s /Applications/Xcode_10.3.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/Library/CoreSimulator/Profiles/Runtimes/iOS.simruntime /Library/Developer/CoreSimulator/Profiles/Runtimes/iOS\ 12.4.simruntime
            xcrun simctl list runtimes
            xcrun simctl create custom-test-device "iPad Pro (9.7-inch)" "com.apple.CoreSimulator.SimRuntime.iOS-12-4"
            xcrun simctl list devices 12.4
